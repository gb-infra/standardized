<link rel="stylesheet" href="{{ 'component-quick-cart.css' | asset_url }}" media="print" onload="this.media='all'">

<noscript>{{ 'component-quick-cart.css' | asset_url | stylesheet_tag }}</noscript>

<div class="halo-sidebar halo-sidebar-right halo-cart-sidebar" id="halo-cart-sidebar">
  <a href="#" class="halo-sidebar-close" data-close-cart-sidebar alt="{{ 'general.common.close' | t }}">
    {% render 'icon-close' %}
    {{ 'general.common.close' | t }}
  </a>
  <div class="halo-sidebar-header text-left">
    <span class="title">
      {{ 'sections.cart.my_cart' | t }}
    </span>
    <div class="wrapper-cartCount">
      <span class="cartCount" data-cart-count>{{ cart.item_count }}</span>
      <span>{{ 'sections.cart.items' | t }}</span>
      <input type="button" onclick="openCheckoutModal()" value="Checkout">
    </div>
  </div>
  <div class="halo-sidebar-wrapper custom-scrollbar {{cart.items}}">
    {%- if settings.show_calculator_free_shipping_message -%}
      <div class="previewCartMessage">
        <div class="haloCalculatorShipping">
          <div
            class="progress{% if cart.item_count == 0 %} progress-hidden{% endif %}"
            data-text-enabled="{{ settings.calculator_free_shipping_message_show_percent  }}"
            data-shipping-progress
          >
            <div class="progress_shipping" role="progressbar">
              <div class="progress-meter" style="width: 0">
                {% if settings.calculator_free_shipping_message_show_percent %}
                  <span class="text">0%</span>
                {% endif %}
                {% if settings.calculator_free_shipping_message_show_truck %}
                  <div class="progress-truck-wrapper">
                    {% render 'icon-shipping-truck' %}
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="message" data-shipping-message></div>
        </div>
      </div>
    {%- endif -%}
    <div class="previewCart-wrapper"></div>
  </div>
</div>
<div class="checkout-modal">
  {% render 'checkout-modal' %}
</div>
<script src="{{ 'halo-toolcart.js' | asset_url }}" defer="defer"></script>
<script>
    function cartDetailsFetch() {
    // console.log(arguments);
    //     var salt_value = salt.substring(random_num, random_num+10);

    // var store_channel_name = '{{settings.store_channel_name}}';

    // {% if customer.name != blank %}
    //   var customer_name ='{{customer.name}}';
    // {% else %}
    //   var customer_name = '';
    // {% endif %}
    // {% if customer.email != blank %}
    //   var customer_email = '{{ customer.email }}';
    // {% else %}
    //   var customer_email = '';
    // {% endif %}

    // {% if customer.phone != blank %}
    //   var customer_phone = '{{ customer.phone }}';
    // {% else %}
    //   var customer_phone = '9837664145';
    // {% endif %}
    // var customer_id = '{{ customer.id }}';

    return {
      customer: {
        id: '{{ order.customer.id }}',
        name : '{{ checkout.customer.name }}',
        email: '{{ customer.email }}',
        phoneNumber: '{{ customer.phone }}'
      }
    };
  }
  function openCheckoutModal() {
    const modal = document.getElementById('checkout-popup');
    modal.classList.remove('hide-checkout');
    console.log(cartDetailsFetch());
    const iframe = document.getElementById('checkout-iframe');
    const cartContents = fetch(window.Shopify.routes.root + "cart.js").then((response) => response.json()).then((cart) => {
      iframe.contentWindow.postMessage(cart, "http://localhost:3001/");
    });
    window.addEventListener('message', (e) => {
      console.log(e);
      if (e?.data?.orderPlaced) {
         console.log('order is place on shopify & clearing cart');
          jQuery.post(window.Shopify.routes.root + "cart/clear.js").then((resp) => { console.log(resp)});
          const modal = document.getElementById('checkout-popup');
          modal.classList.add('hide-checkout');
      }
    });
  }
</script>
